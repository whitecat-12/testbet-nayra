<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Nayra - AI Pintar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      height: 100%;
      background: black;
      overflow: hidden;
    }

    #idle, #avatar {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 0;
      max-width: 100vw;
      max-height: 100vh;
      width: auto;
      height: auto;
      filter: brightness(1);
      background: black;
    }

    #avatar {
      display: none;
    }

    .overlay {
      position: absolute;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
      display: flex;
      gap: 1.5rem;
    }

    .mic-button {
      background: linear-gradient(to bottom right, #00ff9d, #00c76d);
      color: white;
      border: none;
      padding: 1.2rem;
      width: 120px;
      height: 120px;
      font-size: 1rem;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0, 255, 127, 0.6);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      text-align: center;
    }

    .mic-button i {
      font-size: 1.8rem;
      margin-bottom: 0.3rem;
    }

    .mic-button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 25px rgba(0, 255, 127, 0.9);
    }

    .cancel-button {
      background: linear-gradient(to bottom right, #ff4d4d, #a00000);
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
    }

    .cancel-button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 25px rgba(255, 0, 0, 0.9);
    }
  </style>
</head>
<body>

<video id="idle" autoplay muted loop playsinline>
  <source src="media/idle.mp4" type="video/mp4" />
</video>

<video id="avatar" muted loop playsinline>
  <source src="media/avatar.mp4" type="video/mp4" />
</video>

<div class="overlay">
  <button id="micButton" class="mic-button">
    <i class="fas fa-microphone"></i>
    Bicara
  </button>
  <button id="cancelButton" class="mic-button cancel-button">
    <i class="fas fa-times"></i>
    Batal
  </button>
</div>

<script>
const GROQ_API_KEY = "Bearer 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";
const idle = document.getElementById("idle");
const avatar = document.getElementById("avatar");

let recognition = null;
let ucap = null;

async function mulaiRekam() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("Perangkat tidak mendukung speech recognition.");
    return;
  }

  recognition = new SpeechRecognition();
  recognition.lang = 'id-ID';
  recognition.interimResults = false;

  recognition.onresult = async function(event) {
    const teks = event.results[0][0].transcript;
    recognition.stop(); // Penting untuk Android
    recognition = null;

    // Cek jika perintahnya adalah untuk menari
    if (teks.toLowerCase().includes("dance") || teks.toLowerCase().includes("nari") || teks.toLowerCase().includes("menari")) {
      mulaiDance();
    } else {
      const jawaban = await tanyaAI(teks);
      bicara(jawaban);
    }
  };

  recognition.onerror = function(event) {
    console.error("Error:", event.error);
    recognition.stop();
    recognition = null;
  };

  recognition.start();
}

async function tanyaAI(teks) {
  try {
    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": GROQ_API_KEY,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "llama3-8b-8192",
        messages: [
          {
            role: "system",
            content: "Kamu adalah Nayra AI, asisten pintar dari teta.edu. Jawablah dengan ramah, sopan, dan mudah dipahami."
          },
          {
            role: "user",
            content: teks
          }
        ],
        temperature: 0.7
      })
    });

    const data = await res.json();
    if (data.error) return "⚠️ Error: " + data.error.message;
    return data.choices?.[0]?.message?.content || "Maaf, tidak ada jawaban.";
  } catch (e) {
    console.error("Gagal fetch:", e);
    return "⚠️ Gagal menghubungi AI.";
  }
}

function mulaiDance() {
  // Ganti video ke avatar dance
  avatar.style.display = 'block';
  avatar.src = "media/dance.mp4";  // Ganti dengan video dance yang sesuai
  avatar.currentTime = 0;
  avatar.play().catch(err => console.warn("Video gagal:", err));

  // Tidak ada bicara, hanya menari
}

function bicara(teks) {
  ucap = new SpeechSynthesisUtterance(teks);
  ucap.lang = "id-ID";

  idle.style.display = 'none';
  avatar.style.display = 'block';
  avatar.currentTime = 0;
  avatar.play().catch(err => console.warn("Video gagal:", err));
  speechSynthesis.speak(ucap);

  ucap.onend = () => {
    avatar.pause();
    avatar.style.display = 'none';
    idle.style.display = 'block';
    ucap = null;
  };
}

function cancelSemua() {
  if (recognition) recognition.abort();
  if (speechSynthesis.speaking || speechSynthesis.pending) speechSynthesis.cancel();
  avatar.pause();
  avatar.style.display = 'none';
  idle.style.display = 'block';
}

document.getElementById("micButton").onclick = mulaiRekam;
document.getElementById("cancelButton").onclick = cancelSemua;
</script>

</body>
</html>

